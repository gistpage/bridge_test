<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <title>WSD Bridge H5 æµ‹è¯•</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      background: #f4f6fa;
    }

    .banner {
      background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
      color: #fff;
      padding: 32px 20px 20px 20px;
      text-align: center;
      border-bottom-left-radius: 32px;
      border-bottom-right-radius: 32px;
      box-shadow: 0 2px 8px rgba(106, 17, 203, 0.08);
    }

    .banner h1 {
      margin: 0 0 8px 0;
      font-size: 2.2em;
      letter-spacing: 2px;
    }

    .banner p {
      margin: 0;
      font-size: 1.1em;
      opacity: 0.92;
    }

    .env-status {
      margin: 18px auto 0 auto;
      max-width: 520px;
      padding: 10px 0;
      font-size: 1.1em;
      font-weight: bold;
      border-radius: 8px;
      text-align: center;
    }

    .env-ok {
      background: #e6ffed;
      color: #237804;
      border: 1px solid #b7eb8f;
    }

    .env-fail {
      background: #fff1f0;
      color: #cf1322;
      border: 1px solid #ffa39e;
    }

    .section {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      padding: 22px 18px 18px 18px;
      margin: 28px auto 0 auto;
      max-width: 520px;
      border-left: 6px solid #6a11cb;
      position: relative;
    }

    .section h2 {
      color: #2575fc;
      margin-top: 0;
      font-size: 1.25em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section .icon {
      font-size: 1.3em;
      margin-right: 4px;
    }

    label {
      display: block;
      margin-top: 8px;
      font-weight: 500;
    }

    input,
    textarea {
      width: 100%;
      margin-top: 4px;
      margin-bottom: 8px;
      border-radius: 6px;
      border: 1px solid #d0d7e2;
      padding: 7px 10px;
      font-size: 1em;
      background: #f8fafd;
    }

    button {
      margin-top: 8px;
      padding: 10px 0;
      width: 100%;
      border: none;
      border-radius: 6px;
      font-size: 1.1em;
      font-weight: bold;
      background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
      color: #fff;
      cursor: pointer;
      box-shadow: 0 1px 4px rgba(106, 17, 203, 0.08);
      transition: background 0.2s;
    }

    button:hover {
      background: linear-gradient(90deg, #2575fc 0%, #6a11cb 100%);
    }

    .result-box {
      background: #f0f7ff;
      color: #1a237e;
      border-radius: 6px;
      border: 1px solid #b3c6e6;
      margin-top: 8px;
      padding: 8px 10px;
      font-size: 15px;
      min-height: 22px;
      font-family: 'Fira Mono', 'Consolas', 'Menlo', monospace;
      word-break: break-all;
    }

    .tip {
      background: #fffbe6;
      color: #b8860b;
      border-left: 5px solid #ffe066;
      padding: 10px 14px;
      border-radius: 8px;
      margin: 18px auto 0 auto;
      max-width: 520px;
      font-size: 1em;
      font-weight: 500;
    }

    @media (max-width: 600px) {

      .section,
      .tip,
      .env-status {
        max-width: 98vw;
      }

      .banner {
        padding: 24px 4vw 14px 4vw;
      }
    }

    .accordion {
      border: 1px solid #b3c6e6;
      border-radius: 8px;
      margin-bottom: 14px;
      background: #f8fafd;
    }

    .accordion-header {
      cursor: pointer;
      padding: 10px 12px;
      font-weight: bold;
      color: #2575fc;
      display: flex;
      align-items: center;
      justify-content: space-between;
      user-select: none;
    }

    .accordion-arrow {
      font-size: 1.1em;
      transition: transform 0.2s;
    }

    .accordion-arrow.open {
      transform: rotate(90deg);
    }

    .accordion-content {
      display: none;
      padding: 0 12px 12px 12px;
    }

    .accordion.open .accordion-content {
      display: block;
    }

    .accordion-main {
      border: 2px solid #b3c6e6;
      border-radius: 14px;
      margin: 28px auto 0 auto;
      background: #fff;
      max-width: 520px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      border-left: 6px solid #6a11cb;
      position: relative;
    }

    .accordion-main-header {
      cursor: pointer;
      padding: 18px 18px 18px 24px;
      font-size: 1.25em;
      font-weight: bold;
      color: #2575fc;
      display: flex;
      align-items: center;
      justify-content: space-between;
      user-select: none;
      border-radius: 14px 14px 0 0;
      background: #f4f6fa;
    }

    .accordion-main-arrow {
      font-size: 1.2em;
      transition: transform 0.2s;
    }

    .accordion-main-arrow.open {
      transform: rotate(90deg);
    }

    .accordion-main-content {
      display: none;
      padding: 0 18px 18px 18px;
    }

    .accordion-main.open .accordion-main-content {
      display: block;
    }
  </style>
</head>

<body>
  <div class="banner">
    <h1>ğŸ§ª WSD Bridge H5 </h1>
    <p>ä¸€ç«™å¼éªŒè¯ <b>JSBridge</b> ä¸åŸç”Ÿæ¡¥æ¥èƒ½åŠ›ï¼Œæ”¯æŒ eventTrackerã€openWebViewã€å‚æ•°æ ¡éªŒã€å›è°ƒç­‰å…¨æµç¨‹ã€‚<br>è¯·åœ¨ App WebView ä¸­è®¿é—®æœ¬é¡µï¼Œæ‰€æœ‰ç»“æœå®æ—¶é«˜äº®å±•ç¤ºã€‚</p>
  </div>

  <div id="pageTimestamp" class="env-status"
    style="background:#fffbe6;color:#b8860b;border:1px solid #ffe066;margin-top:8px;">é¡µé¢åŠ è½½æ—¶é—´æˆ³ï¼š<span
      id="timestampValue"></span></div>

  <div id="envStatus" class="env-status">ç¯å¢ƒæ£€æµ‹ä¸­...</div>

  <div class="section">
    <h2><span class="icon">ğŸ“Š</span>1. eventTracker æµ‹è¯•</h2>
    <label>eventName:</label>
    <input id="eventTrackerName" value="test_event" />
    <label>eventValue (JSON):</label>
    <textarea id="eventTrackerValue">{"foo": "bar"}</textarea>
    <button onclick="callEventTracker()">ğŸš€ è°ƒç”¨ eventTracker</button>
    <div id="result-eventTracker" class="result-box"></div>
    <button onclick="copyResult('result-eventTracker')"
      style="margin-top:4px;background:#e6f7ff;color:#1890ff;">å¤åˆ¶ç»“æœ</button>

    <hr style="margin:24px 0;">
    <div style="font-size:1em;color:#2575fc;margin-bottom:8px;">ã€å®˜æ–¹äº‹ä»¶å‚æ•°å¯ç¼–è¾‘æµ‹è¯•ã€‘</div>
    <div id="eventTrackerOfficialTests"></div>
  </div>

  <div class="section">
    <h2><span class="icon">ğŸŒ</span>2. openWebView æµ‹è¯•</h2>
    <label>url:</label>
    <input id="openWebViewUrl" value="https://flutter.dev" />
    <label>type (1=å¤–è·³, 2=å†…åµŒ):</label>
    <input id="openWebViewType" value="2" />
    <button onclick="callOpenWebView(2, 'https://www.example.com')">æµ‹è¯•å†…è·³ï¼ˆtype=2ï¼‰</button>
    <button onclick="callOpenWebView(1, 'https://www.example.com')">æµ‹è¯•å¤–è·³ï¼ˆtype=1ï¼‰</button>
    <div id="resultBox" style="margin-top:20px;"></div>
    <button onclick="copyResult('resultBox')" style="margin-top:4px;background:#e6f7ff;color:#1890ff;">å¤åˆ¶ç»“æœ</button>
  </div>

  <div class="section">
    <h2><span class="icon">ğŸŒ</span>3. openAndroid æµ‹è¯•</h2>
    <label>url:</label>
    <input id="openAndroidUrl" value="https://www.baidu.com" />
    <button onclick="callOpenAndroid()">ğŸ”— è°ƒç”¨ openAndroid</button>
    <div id="result-openAndroid" class="result-box"></div>
    <button onclick="copyResult('result-openAndroid')"
      style="margin-top:4px;background:#e6f7ff;color:#1890ff;">å¤åˆ¶ç»“æœ</button>
  </div>

  <div class="section">
    <h2><span class="icon">âŒ</span>4. closeWebView æµ‹è¯•</h2>
    <button onclick="callCloseWebView()">ğŸ›‘ è°ƒç”¨ closeWebView</button>
    <div id="result-closeWebView" class="result-box"></div>
    <button onclick="copyResult('result-closeWebView')"
      style="margin-top:4px;background:#e6f7ff;color:#1890ff;">å¤åˆ¶ç»“æœ</button>
    <div style="text-align:center;margin:16px 0;">
      <button onclick="openChildTestPage()" style="width:auto;padding:8px 24px;font-size:1em;">æ‰“å¼€äºŒçº§æµ‹è¯•é¡µï¼ˆæ–°æ ‡ç­¾é¡µï¼‰</button>
    </div>
  </div>

  <div class="section">
    <h2><span class="icon">ğŸ§‘â€ğŸ’»</span>5. getUseragent æµ‹è¯•</h2>
    <button onclick="callGetUseragent()">ğŸ” è·å– useragent</button>
    <div id="result-getUseragent" class="result-box"></div>
    <button onclick="copyResult('result-getUseragent')"
      style="margin-top:4px;background:#e6f7ff;color:#1890ff;">å¤åˆ¶ç»“æœ</button>
  </div>

  <div class="section">
    <h2><span class="icon">ğŸ”‘</span>6. googleLogin æµ‹è¯•</h2>
    <button onclick="callGoogleLogin()">ğŸ”‘ è°ƒç”¨ googleLogin</button>
    <div id="result-googleLogin" class="result-box"></div>
    <button onclick="copyResult('result-googleLogin')"
      style="margin-top:4px;background:#e6f7ff;color:#1890ff;">å¤åˆ¶ç»“æœ</button>
  </div>

  <div class="section">
    <h2><span class="icon">ğŸ”µ</span>7. facebookLogin æµ‹è¯•</h2>
    <button onclick="callFacebookLogin()">ğŸ”µ è°ƒç”¨ facebookLogin</button>
    <div id="result-facebookLogin" class="result-box"></div>
    <button onclick="copyResult('result-facebookLogin')"
      style="margin-top:4px;background:#e6f7ff;color:#1890ff;">å¤åˆ¶ç»“æœ</button>
  </div>

  <div class="section">
    <h2><span class="icon">ğŸ“¬</span>8. getFcmToken æµ‹è¯•</h2>
    <button onclick="callGetFcmToken()">ğŸ“¬ è°ƒç”¨ getFcmToken</button>
    <div id="result-getFcmToken" class="result-box"></div>
    <button onclick="copyResult('result-getFcmToken')"
      style="margin-top:4px;background:#e6f7ff;color:#1890ff;">å¤åˆ¶ç»“æœ</button>
  </div>

  <div class="section">
    <h2><span class="icon">âš ï¸</span>9. alert æµ‹è¯•</h2>
    <label>message:</label>
    <input id="alertMsg" value="Hello from H5!" />
    <button onclick="callAlert()">âš ï¸ è°ƒç”¨ alert</button>
    <div id="result-alert" class="result-box"></div>
    <button onclick="copyResult('result-alert')" style="margin-top:4px;background:#e6f7ff;color:#1890ff;">å¤åˆ¶ç»“æœ</button>
  </div>

  <div class="section">
    <h2><span class="icon">ğŸŒ</span>10. openWindow æµ‹è¯•</h2>
    <label>url:</label>
    <input id="openWindowUrl" value="https://www.baidu.com" />
    <button onclick="callOpenWindow()">ğŸŒ è°ƒç”¨ openWindow</button>
    <div id="result-openWindow" class="result-box"></div>
    <button onclick="copyResult('result-openWindow')"
      style="margin-top:4px;background:#e6f7ff;color:#1890ff;">å¤åˆ¶ç»“æœ</button>
  </div>

  <div class="section">
    <h2><span class="icon">ğŸ”—</span>11. handleHtmlLink æµ‹è¯•</h2>
    <label>url:</label>
    <input id="handleHtmlLinkUrl" value="https://www.baidu.com" />
    <button onclick="callHandleHtmlLink()">ğŸ”— è°ƒç”¨ handleHtmlLink</button>
    <div id="result-handleHtmlLink" class="result-box"></div>
    <button onclick="copyResult('result-handleHtmlLink')"
      style="margin-top:4px;background:#e6f7ff;color:#1890ff;">å¤åˆ¶ç»“æœ</button>

    <hr style="margin:24px 0;">
    <div style="font-size:1em;color:#2575fc;margin-bottom:8px;">ã€é«˜çº§åœºæ™¯æ¨¡æ‹Ÿã€‘aæ ‡ç­¾ç‚¹å‡»æ‹¦æˆª + handleHtmlLink</div>
    <label>æ¨¡æ‹Ÿä¸šåŠ¡åœºæ™¯ï¼š</label>
    <select id="handleHtmlLinkScene">
      <option value="white">ç™½åå•è‡ªåŠ¨è·³è½¬</option>
      <option value="black">é»‘åå•æ‹¦æˆªå¼¹çª—</option>
      <option value="login">éœ€ç™»å½•å¼¹çª—</option>
      <option value="app">Appç«¯å·²å¤„ç†ï¼ˆH5ä¸è·³è½¬ï¼‰</option>
      <option value="h5">Appç«¯æœªå¤„ç†ï¼ˆH5è‡ªè¡Œè·³è½¬ï¼‰</option>
      <option value="other">å…¶ä»–/é»˜è®¤åœºæ™¯ï¼ˆH5è‡ªè¡Œè·³è½¬ï¼‰</option>
    </select>
    <input id="handleHtmlLinkAUrl" value="https://www.example.com" style="margin-top:8px;" />
    <a id="handleHtmlLinkATag" href="https://www.example.com"
      style="display:inline-block;margin:8px 0 0 0;color:#2575fc;text-decoration:underline;">ç‚¹å‡»æ¨¡æ‹Ÿ a æ ‡ç­¾</a>
    <div id="result-handleHtmlLinkA" class="result-box"></div>
    <div style="color:#888;font-size:0.95em;margin-top:8px;">è¯´æ˜ï¼šç‚¹å‡»ä¸Šæ–¹ a æ ‡ç­¾ä¼šæ‹¦æˆªå¹¶è°ƒç”¨ handleHtmlLinkï¼ŒAppç«¯å¯æ ¹æ®
      url/åœºæ™¯è¿”å›ä¸åŒç»“æœï¼ŒH5æ ¹æ®è¿”å›å€¼å†³å®šæ˜¯å¦è·³è½¬/å¼¹çª—ã€‚</div>
  </div>


  <!-- ========== åŸç”ŸJSèƒ½åŠ›æ¡¥æ¥æµ‹è¯• ========== -->
  <div class="section">
    <h2><span class="icon">ğŸ§©</span>12. åŸç”ŸJSèƒ½åŠ›æ¡¥æ¥æµ‹è¯•</h2>
    <label>window.alert æµ‹è¯•</label>
    <input id="jsAlertMsg" value="Hello from window.alert!" />
    <button onclick="testJsAlert()">ğŸŸ£ è°ƒç”¨ window.alert</button>
    <div id="result-jsAlert" class="result-box"></div>

    <label style="margin-top:16px;">window.confirm æµ‹è¯•</label>
    <input id="jsConfirmMsg" value="Are you sure?" />
    <button onclick="testJsConfirm()">ğŸŸ¢ è°ƒç”¨ window.confirm</button>
    <div id="result-jsConfirm" class="result-box"></div>

    <label style="margin-top:16px;">window.prompt æµ‹è¯•</label>
    <input id="jsPromptMsg" value="è¯·è¾“å…¥å†…å®¹" />
    <input id="jsPromptDefault" value="é»˜è®¤å€¼" />
    <button onclick="testJsPrompt()">ğŸŸ  è°ƒç”¨ window.prompt</button>
    <div id="result-jsPrompt" class="result-box"></div>

    <label style="margin-top:16px;">window.open æµ‹è¯•</label>
    <input id="jsOpenUrl" value="https://flutter.dev" />
    <button onclick="testJsOpen()">ğŸ”µ è°ƒç”¨ window.open</button>
    <div id="result-jsOpen" class="result-box"></div>

    <label style="margin-top:16px;">aæ ‡ç­¾è¶…é“¾æ¥æµ‹è¯•</label>
    <input id="jsALink" value="https://www.baidu.com" />
    <a id="testALink" href="https://www.baidu.com" target="_blank"
      style="display:inline-block;margin-top:8px;color:#2575fc;text-decoration:underline;">ç‚¹å‡»è·³è½¬ a æ ‡ç­¾</a>
    <div id="result-jsALink" class="result-box"></div>
  </div>

  <script>
    console.log('H5 JS loaded at', new Date());

    // ç¯å¢ƒæ£€æµ‹
    function checkBridgeEnv() {
      var envStatus = document.getElementById('envStatus');
      if (window.flutter_inappwebview && typeof window.flutter_inappwebview.callHandler === 'function') {
        envStatus.textContent = 'âœ… å·²æ£€æµ‹åˆ°æ¡¥æ¥ç¯å¢ƒï¼Œå¯æ­£å¸¸è°ƒç”¨';
        envStatus.className = 'env-status env-ok';
        return true;
      } else {
        envStatus.textContent = 'âŒ æœªæ£€æµ‹åˆ°æ¡¥æ¥ç¯å¢ƒï¼Œè¯·åœ¨Appå†…WebViewä¸­æ‰“å¼€';
        envStatus.className = 'env-status env-fail';
        return false;
      }
    }
    checkBridgeEnv();

    // eventTracker æµ‹è¯•
    function callEventTracker() {
      if (!checkBridgeEnv()) {
        showResult('result-eventTracker', 'eventTracker', {}, '[æœªæ£€æµ‹åˆ°æ¡¥æ¥ç¯å¢ƒ]');
        return;
      }
      let eventName = document.getElementById('eventTrackerName').value;
      let eventValue = safeParse(document.getElementById('eventTrackerValue').value);
      if (!eventName || !eventValue) return;
      window.flutter_inappwebview.callHandler('eventTracker', { eventName, eventValue })
        .then(function (result) {
          showResult('result-eventTracker', 'eventTracker', { eventName, eventValue }, result);
        })
        .catch(function (err) {
          showResult('result-eventTracker', 'eventTracker', { eventName, eventValue }, '[å¼‚å¸¸] ' + err);
        });
    }

    // openWebView æµ‹è¯•
    function callOpenWebView(type, url) {
      const params = { type, url };
      if (window.flutter_inappwebview && window.flutter_inappwebview.callHandler) {
        window.flutter_inappwebview.callHandler('openWebView', params).then(function (result) {
          console.log('openWebView result:', result);
          showResult('resultBox', 'openWebView', params, result);
          if (!result) {
            alert('æ’ä»¶è¿”å›ç»“æœä¸º nullï¼Œè¯·æ£€æŸ¥æ’ä»¶ç«¯ openWebView handler çš„è¿”å›å€¼ï¼');
            return;
          }
          if (result.code === 0 && result.data && result.data.type && result.data.url) {
            if (result.data.type === 2) {
              window.location.href = result.data.url;
            } else if (result.data.type === 1) {
              window.open(result.data.url, '_blank');
            }
          }
        });
      } else {
        showResult('resultBox', 'openWebView', params, { code: -1, msg: 'æœªæ£€æµ‹åˆ° flutter_inappwebview ç¯å¢ƒ', data: null });
      }
    }

    // openAndroid æµ‹è¯•
    function callOpenAndroid() {
      if (!checkBridgeEnv()) {
        showResult('result-openAndroid', 'openAndroid', {}, '[æœªæ£€æµ‹åˆ°æ¡¥æ¥ç¯å¢ƒ]');
        return;
      }
      let url = document.getElementById('openAndroidUrl').value;
      window.flutter_inappwebview.callHandler('openAndroid', { url })
        .then(function (result) {
          showResult('result-openAndroid', 'openAndroid', { url }, result);
        })
        .catch(function (err) {
          showResult('result-openAndroid', 'openAndroid', { url }, '[å¼‚å¸¸] ' + err);
        });
    }

    // closeWebView æµ‹è¯•
    function callCloseWebView() {
      if (!checkBridgeEnv()) {
        showResult('result-closeWebView', 'closeWebView', {}, '[æœªæ£€æµ‹åˆ°æ¡¥æ¥ç¯å¢ƒ]');
        return;
      }
      window.flutter_inappwebview.callHandler('closeWebView', {})
        .then(function (result) {
          showResult('result-closeWebView', 'closeWebView', {}, result);
          // ä»…åœ¨äºŒçº§é¡µé¢è‡ªåŠ¨å…³é—­
          if (isChildPage() && result && result.code === 0 && result.data && result.data.closed === true) {
            window.close();
            // å…œåº•ï¼šå…³é—­å¤±è´¥æ—¶è¿”å›ä¸Šä¸€é¡µ
            setTimeout(function () {
              if (!window.closed) {
                window.history.back();
              }
            }, 300);
          }
        })
        .catch(function (err) {
          showResult('result-closeWebView', 'closeWebView', {}, '[å¼‚å¸¸] ' + err);
        });
    }

    // getUseragent æµ‹è¯•
    function callGetUseragent() {
      if (!checkBridgeEnv()) {
        showResult('result-getUseragent', 'getUseragent', {}, '[æœªæ£€æµ‹åˆ°æ¡¥æ¥ç¯å¢ƒ]');
        return;
      }
      window.flutter_inappwebview.callHandler('getUseragent', {})
        .then(function (result) {
          showResult('result-getUseragent', 'getUseragent', {}, result);
        })
        .catch(function (err) {
          showResult('result-getUseragent', 'getUseragent', {}, '[å¼‚å¸¸] ' + err);
        });
    }

    // googleLogin æµ‹è¯•
    function callGoogleLogin() {
      if (!checkBridgeEnv()) {
        showResult('result-googleLogin', 'googleLogin', {}, '[æœªæ£€æµ‹åˆ°æ¡¥æ¥ç¯å¢ƒ]');
        return;
      }
      window.flutter_inappwebview.callHandler('googleLogin', {})
        .then(function (result) {
          showResult('result-googleLogin', 'googleLogin', {}, result);
        })
        .catch(function (err) {
          showResult('result-googleLogin', 'googleLogin', {}, '[å¼‚å¸¸] ' + err);
        });
    }

    // facebookLogin æµ‹è¯•
    function callFacebookLogin() {
      if (!checkBridgeEnv()) {
        showResult('result-facebookLogin', 'facebookLogin', {}, '[æœªæ£€æµ‹åˆ°æ¡¥æ¥ç¯å¢ƒ]');
        return;
      }
      window.flutter_inappwebview.callHandler('facebookLogin', {})
        .then(function (result) {
          showResult('result-facebookLogin', 'facebookLogin', {}, result);
        })
        .catch(function (err) {
          showResult('result-facebookLogin', 'facebookLogin', {}, '[å¼‚å¸¸] ' + err);
        });
    }

    // getFcmToken æµ‹è¯•
    function callGetFcmToken() {
      if (!checkBridgeEnv()) {
        showResult('result-getFcmToken', 'getFcmToken', {}, '[æœªæ£€æµ‹åˆ°æ¡¥æ¥ç¯å¢ƒ]');
        return;
      }
      window.flutter_inappwebview.callHandler('getFcmToken', {})
        .then(function (result) {
          showResult('result-getFcmToken', 'getFcmToken', {}, result);
        })
        .catch(function (err) {
          showResult('result-getFcmToken', 'getFcmToken', {}, '[å¼‚å¸¸] ' + err);
        });
    }

    // alert æµ‹è¯•
    function callAlert() {
      if (!checkBridgeEnv()) {
        showResult('result-alert', 'alert', {}, '[æœªæ£€æµ‹åˆ°æ¡¥æ¥ç¯å¢ƒ]');
        return;
      }
      let message = document.getElementById('alertMsg').value;
      window.flutter_inappwebview.callHandler('alert', { message })
        .then(function (result) {
          showResult('result-alert', 'alert', { message }, result);
        })
        .catch(function (err) {
          showResult('result-alert', 'alert', { message }, '[å¼‚å¸¸] ' + err);
        });
    }

    // openWindow æµ‹è¯•
    function callOpenWindow() {
      if (!checkBridgeEnv()) {
        showResult('result-openWindow', 'openWindow', {}, '[æœªæ£€æµ‹åˆ°æ¡¥æ¥ç¯å¢ƒ]');
        return;
      }
      let url = document.getElementById('openWindowUrl').value;
      window.flutter_inappwebview.callHandler('openWindow', { url })
        .then(function (result) {
          showResult('result-openWindow', 'openWindow', { url }, result);
        })
        .catch(function (err) {
          showResult('result-openWindow', 'openWindow', { url }, '[å¼‚å¸¸] ' + err);
        });
    }

    // handleHtmlLink æµ‹è¯•
    function callHandleHtmlLink() {
      if (!checkBridgeEnv()) {
        showResult('result-handleHtmlLink', 'handleHtmlLink', {}, '[æœªæ£€æµ‹åˆ°æ¡¥æ¥ç¯å¢ƒ]');
        return;
      }
      let url = document.getElementById('handleHtmlLinkUrl').value;
      window.flutter_inappwebview.callHandler('handleHtmlLink', { url })
        .then(function (result) {
          showResult('result-handleHtmlLink', 'handleHtmlLink', { url }, result);
        })
        .catch(function (err) {
          showResult('result-handleHtmlLink', 'handleHtmlLink', { url }, '[å¼‚å¸¸] ' + err);
        });
    }

    function showResult(boxId, method, params, result) {
      let box = document.getElementById(boxId);
      let msg = `[${new Date().toLocaleTimeString()}] æ–¹æ³•: ${method}\nå‚æ•°: ${JSON.stringify(params)}\nåŸå§‹ç»“æœ: ${JSON.stringify(result)}`;
      box.innerHTML = `<span style='color:#2575fc;'>${msg.replace(/\n/g, '<br>')}</span>`;
    }

    // JSONå®‰å…¨è§£æ
    function safeParse(str) {
      try {
        return JSON.parse(str);
      } catch (e) {
        alert('å‚æ•°ä¸æ˜¯åˆæ³•JSON');
        return null;
      }
    }

    function copyResult(boxId) {
      var box = document.getElementById(boxId);
      var text = box.innerText || box.textContent;
      if (!text) return;
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(function () {
          alert('ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        });
      } else {
        // å…¼å®¹æ—§æµè§ˆå™¨
        var textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
      }
    }

    // æ˜¾ç¤ºå½“å‰æ—¶é—´æˆ³ï¼Œä¾¿äºåˆ¤æ–­é¡µé¢æ˜¯å¦è¢«ç¼“å­˜
    document.getElementById('timestampValue').textContent = Date.now();

    // æ‰“å¼€äºŒçº§æµ‹è¯•é¡µ
    let isOpeningChildPage = false; // é˜²é‡å¤ç‚¹å‡»
    function openChildTestPage() {
      if (isOpeningChildPage) {
        console.log('æ­£åœ¨æ‰“å¼€äºŒçº§æµ‹è¯•é¡µï¼Œè¯·å‹¿é‡å¤ç‚¹å‡»');
        return;
      }

      isOpeningChildPage = true;
      const childUrl = window.location.href.split('?')[0] + '?scene=child';

      // ä¼˜å…ˆä½¿ç”¨ openWebView å†…åµŒè·³è½¬ï¼ˆtype=2ï¼‰
      if (window.flutter_inappwebview && window.flutter_inappwebview.callHandler) {
        console.log('ä½¿ç”¨æ¡¥æ¥æ–¹å¼æ‰“å¼€äºŒçº§æµ‹è¯•é¡µ:', childUrl);
        window.flutter_inappwebview.callHandler('openWebView', {
          type: 2,
          url: childUrl
        }).then(function (result) {
          console.log('æ‰“å¼€äºŒçº§æµ‹è¯•é¡µ openWebView result:', result);
          // æ£€æŸ¥æ¡¥æ¥è°ƒç”¨æ˜¯å¦æˆåŠŸ
          if (result && result.code === 0 && result.data && result.data.opened) {
            console.log('æ¡¥æ¥è·³è½¬æˆåŠŸï¼Œé¡µé¢å°†åœ¨å½“å‰WebViewä¸­åŠ è½½');
            // æˆåŠŸæ—¶ä¸éœ€è¦é¢å¤–æ“ä½œï¼ŒWebViewä¼šè‡ªåŠ¨åŠ è½½æ–°é¡µé¢
          } else {
            // å¦‚æœæ¡¥æ¥å¤±è´¥ï¼Œå›é€€åˆ° window.open
            console.warn('æ¡¥æ¥è·³è½¬å¤±è´¥ï¼Œå›é€€åˆ° window.openã€‚result:', result);
            window.open(childUrl, '_blank');
          }
          // å»¶è¿Ÿé‡ç½®é˜²é‡å¤æ ‡å¿—
          setTimeout(() => { isOpeningChildPage = false; }, 1000);
        }).catch(function (err) {
          console.error('æ¡¥æ¥è·³è½¬å¼‚å¸¸ï¼Œå›é€€åˆ° window.open:', err);
          window.open(childUrl, '_blank');
          setTimeout(() => { isOpeningChildPage = false; }, 1000);
        });
      } else {
        // æœªæ£€æµ‹åˆ°æ¡¥æ¥ç¯å¢ƒï¼Œç›´æ¥ä½¿ç”¨ window.open
        console.log('æœªæ£€æµ‹åˆ°æ¡¥æ¥ç¯å¢ƒï¼Œä½¿ç”¨ window.open');
        window.open(childUrl, '_blank');
        setTimeout(() => { isOpeningChildPage = false; }, 1000);
      }
    }

    // åˆ¤æ–­æ˜¯å¦ä¸ºäºŒçº§æµ‹è¯•é¡µ
    function isChildPage() {
      return /[?&]scene=child/.test(window.location.search);
    }

    function testJsAlert() {
      let msg = document.getElementById('jsAlertMsg').value;
      let t0 = Date.now();
      alert(msg);
      let t1 = Date.now();
      document.getElementById('result-jsAlert').innerHTML =
        `<span style='color:#2575fc;'>alertå¼¹çª—å·²è°ƒç”¨ï¼Œè€—æ—¶${t1 - t0}ms</span>`;
    }

    function testJsConfirm() {
      let msg = document.getElementById('jsConfirmMsg').value;
      let t0 = Date.now();
      let result = confirm(msg);
      let t1 = Date.now();
      document.getElementById('result-jsConfirm').innerHTML =
        `<span style='color:#2575fc;'>confirmå¼¹çª—ç»“æœ: <b>${result}</b>ï¼Œè€—æ—¶${t1 - t0}ms</span>`;
    }

    function testJsPrompt() {
      let msg = document.getElementById('jsPromptMsg').value;
      let def = document.getElementById('jsPromptDefault').value;
      let t0 = Date.now();
      let result = prompt(msg, def);
      let t1 = Date.now();
      document.getElementById('result-jsPrompt').innerHTML =
        `<span style='color:#2575fc;'>promptå¼¹çª—ç»“æœ: <b>${result}</b>ï¼Œè€—æ—¶${t1 - t0}ms</span>`;
    }

    function testJsOpen() {
      let url = document.getElementById('jsOpenUrl').value;
      let t0 = Date.now();
      window.open(url, '_blank');
      let t1 = Date.now();
      document.getElementById('result-jsOpen').innerHTML =
        `<span style='color:#2575fc;'>window.openå·²è°ƒç”¨ï¼Œè€—æ—¶${t1 - t0}ms</span>`;
    }

    // åŠ¨æ€ç»‘å®šaæ ‡ç­¾href
    document.getElementById('jsALink').addEventListener('input', function () {
      document.getElementById('testALink').href = this.value;
    });
    document.getElementById('testALink').addEventListener('click', function () {
      document.getElementById('result-jsALink').innerHTML =
        `<span style='color:#2575fc;'>aæ ‡ç­¾å·²ç‚¹å‡»ï¼Œç›®æ ‡: ${this.href}</span>`;
    });

    // handleHtmlLink åœºæ™¯æ¨¡æ‹Ÿ - ç¡®ä¿åœ¨DOMåŠ è½½å®Œæˆåç»‘å®šäº‹ä»¶
    function initializeHandleHtmlLinkEvents() {
      console.log('ğŸ”§ åˆå§‹åŒ– handleHtmlLink äº‹ä»¶ç»‘å®š...');

      // URLè¾“å…¥æ¡†åŒæ­¥åˆ°aæ ‡ç­¾href
      var urlInput = document.getElementById('handleHtmlLinkAUrl');
      var aTag = document.getElementById('handleHtmlLinkATag');

      if (urlInput && aTag) {
        // é˜²æ­¢é‡å¤ç»‘å®šï¼šå…ˆç§»é™¤å¯èƒ½å­˜åœ¨çš„äº‹ä»¶ç›‘å¬å™¨
        urlInput.removeEventListener('input', urlInputHandler);
        aTag.removeEventListener('click', aTagClickHandler);

        // é‡æ–°ç»‘å®šäº‹ä»¶
        urlInput.addEventListener('input', urlInputHandler);
        aTag.addEventListener('click', aTagClickHandler);

        console.log('âœ… handleHtmlLink äº‹ä»¶ç»‘å®šå®Œæˆ');
      } else {
        console.error('âŒ æ‰¾ä¸åˆ°å¿…è¦çš„DOMå…ƒç´ :', { urlInput, aTag });
      }
    }

    // URLè¾“å…¥å¤„ç†å‡½æ•°
    function urlInputHandler() {
      var aTag = document.getElementById('handleHtmlLinkATag');
      if (aTag) {
        aTag.href = this.value;
        console.log('ğŸ”— URLå·²æ›´æ–°:', this.value);
      }
    }

    // aæ ‡ç­¾ç‚¹å‡»å¤„ç†å‡½æ•°
    function aTagClickHandler(e) {
      console.log('ğŸ–±ï¸ aæ ‡ç­¾è¢«ç‚¹å‡»ï¼Œå¼€å§‹æ‹¦æˆªå¤„ç†...');
      e.preventDefault(); // é˜»æ­¢é»˜è®¤è·³è½¬
      e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡

      var url = this.href;
      var scene = document.getElementById('handleHtmlLinkScene').value;

      console.log('ğŸ“‹ å½“å‰åœºæ™¯:', scene);
      console.log('ğŸŒ ç›®æ ‡URL:', url);

      if (window.flutter_inappwebview && window.flutter_inappwebview.callHandler) {
        console.log('ğŸš€ è°ƒç”¨ handleHtmlLink JSBridge...');
        window.flutter_inappwebview.callHandler('handleHtmlLink', { url, scene })
          .then(function (result) {
            console.log('âœ… handleHtmlLink è°ƒç”¨æˆåŠŸ:');
            console.log('- åœºæ™¯:', scene);
            console.log('- URL:', url);
            console.log('- åŸå§‹è¿”å›ç»“æœ:', result);
            console.log('- result.data:', result?.data);
            console.log('- result.data.handled:', result?.data?.handled);
            console.log('- result.data.handledç±»å‹:', typeof (result?.data?.handled));

            let msg = `[${new Date().toLocaleTimeString()}] handleHtmlLink åœºæ™¯: ${scene}\nurl: ${url}\nAppç«¯è¿”å›: ${JSON.stringify(result)}\n`;

            // è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯
            let debugInfo = '';
            if (result && result.data) {
              debugInfo += `\nğŸ” è°ƒè¯•ä¿¡æ¯:\n`;
              debugInfo += `- result.data.handled å€¼: ${result.data.handled}\n`;
              debugInfo += `- result.data.handled ç±»å‹: ${typeof (result.data.handled)}\n`;
              debugInfo += `- == false: ${result.data.handled == false}\n`;
              debugInfo += `- == 'login': ${result.data.handled == 'login'}\n`;
              debugInfo += `- == 'black': ${result.data.handled == 'black'}\n`;
              debugInfo += `- == true: ${result.data.handled == true}\n`;
            }

            document.getElementById('result-handleHtmlLinkA').innerHTML = `<span style='color:#2575fc;'>${(msg + debugInfo).replace(/\n/g, '<br>')}</span>`;

            // H5æ ¹æ®Appç«¯è¿”å›å†³å®šåç»­åŠ¨ä½œï¼ˆå…¼å®¹å„ç§ç±»å‹ï¼‰
            if (result && result.data) {
              const handledValue = result.data.handled;
              if (handledValue === false || handledValue === 'false' || handledValue === 0 || handledValue === '0') {
                // H5è‡ªè¡Œè·³è½¬ï¼Œç›´æ¥è·³è½¬æ— éœ€å¼¹çª—
                console.log('ğŸ”„ æ‰§è¡Œ H5 è‡ªè¡Œè·³è½¬ï¼ˆæ— å¼¹çª—ï¼‰');
                window.location.href = url;
              } else if (handledValue === 'login') {
                // åªå¼¹çª—ï¼Œä¸è·³è½¬
                console.log('ğŸ” æ˜¾ç¤ºç™»å½•æç¤º');
                if (window.flutter_inappwebview && window.flutter_inappwebview.callHandler) {
                  window.flutter_inappwebview.callHandler('alert', { message: 'è¯·å…ˆç™»å½•åå†è®¿é—®è¯¥é“¾æ¥ï¼' });
                } else {
                  alert('è¯·å…ˆç™»å½•åå†è®¿é—®è¯¥é“¾æ¥ï¼');
                }
                // ä¸è·³è½¬
              } else if (handledValue === 'black') {
                // åªå¼¹çª—ï¼Œä¸è·³è½¬
                console.log('ğŸš« æ˜¾ç¤ºæ‹¦æˆªæç¤º');
                if (window.flutter_inappwebview && window.flutter_inappwebview.callHandler) {
                  window.flutter_inappwebview.callHandler('alert', { message: 'è¯¥é“¾æ¥å·²è¢«æ‹¦æˆªï¼Œç¦æ­¢è®¿é—®ï¼' });
                } else {
                  alert('è¯¥é“¾æ¥å·²è¢«æ‹¦æˆªï¼Œç¦æ­¢è®¿é—®ï¼');
                }
                // ä¸è·³è½¬
              } else if (handledValue === true || handledValue === 'true' || handledValue === 1 || handledValue === '1') {
                // åªå¼¹çª—ï¼Œä¸è·³è½¬
                console.log('âœ… Appç«¯å·²å¤„ç†');
                if (window.flutter_inappwebview && window.flutter_inappwebview.callHandler) {
                  window.flutter_inappwebview.callHandler('alert', { message: `åœºæ™¯ "${scene}" - Appç«¯å·²å¤„ç†ï¼ŒH5æ— éœ€æ“ä½œ` });
                } else {
                  alert(`åœºæ™¯ "${scene}" - Appç«¯å·²å¤„ç†ï¼ŒH5æ— éœ€æ“ä½œ`);
                }
                // ä¸è·³è½¬
              } else {
                // åªå¼¹çª—ï¼Œä¸è·³è½¬
                console.log('â“ æœªçŸ¥çš„ handled å€¼:', handledValue);
                if (window.flutter_inappwebview && window.flutter_inappwebview.callHandler) {
                  window.flutter_inappwebview.callHandler('alert', { message: `æœªçŸ¥çš„ handled å€¼: ${handledValue}ï¼Œç±»å‹: ${typeof (handledValue)}` });
                } else {
                  alert(`æœªçŸ¥çš„ handled å€¼: ${handledValue}ï¼Œç±»å‹: ${typeof (handledValue)}`);
                }
                // ä¸è·³è½¬
              }
            } else {
              console.log('âŒ è¿”å›ç»“æœç»“æ„å¼‚å¸¸');
              alert('è¿”å›ç»“æœç»“æ„å¼‚å¸¸ï¼Œæ— æ³•å¤„ç†');
            }
          })
          .catch(function (error) {
            console.error('âŒ handleHtmlLink è°ƒç”¨å¤±è´¥:', error);
            document.getElementById('result-handleHtmlLinkA').innerHTML = `<span style='color:red;'>è°ƒç”¨å¤±è´¥: ${error}</span>`;
          });
      } else {
        console.warn('âŒ æœªæ£€æµ‹åˆ°æ¡¥æ¥ç¯å¢ƒ');
        alert('æœªæ£€æµ‹åˆ°æ¡¥æ¥ç¯å¢ƒï¼Œæ— æ³•è°ƒç”¨ handleHtmlLink');
      }
    }

    // ç«‹å³æ‰§è¡Œäº‹ä»¶ç»‘å®šï¼ˆç¡®ä¿DOMå·²åŠ è½½ï¼‰
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeHandleHtmlLinkEvents);
    } else {
      initializeHandleHtmlLinkEvents();
    }

    // å®˜æ–¹äº‹ä»¶æ ‡å‡†å‚æ•°
    const eventParams = {
      firstOpen: {},
      registerSubmit: { method: 'username' },
      register: {
        method: 'username',
        customerId: 12345,
        customerName: 'å¼ ä¸‰',
        mobileNum: '13800138000'
      },
      depositSubmit: {
        customerName: 'å¼ ä¸‰',
        customerId: 12345,
        revenue: '100',
        value: '100',
        af_revenue: 100
      },
      firstDeposit: {
        customerName: 'å¼ ä¸‰',
        customerId: 12345,
        revenue: '100',
        value: '100',
        af_revenue: 100
      },
      withdraw: {
        customerName: 'å¼ ä¸‰',
        customerId: 12345,
        amount: '-50',
        value: '-50',
        af_revenue: -50
      },
      firstDepositArrival: {
        customerName: 'å¼ ä¸‰',
        customerId: 12345,
        revenue: '100',
        value: '100',
        af_revenue: 100
      },
      deposit: {
        customerName: 'å¼ ä¸‰',
        customerId: 12345,
        revenue: '100',
        value: '100',
        af_revenue: 100
      }
    };

    // 12ä¸ªäº‹ä»¶åï¼ˆå¦‚éœ€æ‰©å±•å¯åœ¨æ­¤è¡¥å……ï¼‰
    const officialEvents = [
      'firstOpen',
      'registerSubmit',
      'register',
      'depositSubmit',
      'firstDeposit',
      'withdraw',
      'firstDepositArrival',
      'deposit',
      'openWebView',
      'openAndroid',
      'closeWebView',
      'getUseragent'
    ];
    const container = document.getElementById('eventTrackerOfficialTests');
    officialEvents.forEach(eventName => {
      const paramStr = JSON.stringify(eventParams[eventName] || {}, null, 2);
      const html = `
        <div class="accordion" id="accordion-${eventName}">
          <div class="accordion-header" onclick="toggleAccordion('${eventName}')">
            <span>${eventName}</span>
            <span class="accordion-arrow" id="arrow-${eventName}">â–¶</span>
          </div>
          <div class="accordion-content">
            <div style="margin-top:6px;">
              <label style="font-weight:500;">eventValue (JSON):</label>
              <textarea id="officialEventValue_${eventName}" style="width:100%;min-height:48px;">${paramStr}</textarea>
            </div>
            <div style="margin-top:6px;display:flex;gap:8px;">
              <button onclick="resetOfficialEventValue('${eventName}')" style="background:#e6f7ff;color:#1890ff;">é‡ç½®ä¸ºæ ‡å‡†å‚æ•°</button>
              <button onclick="testOfficialEventEditable('${eventName}')">æµ‹è¯•</button>
            </div>
            <div id="result-officialEvent-${eventName}" class="result-box" style="margin-top:6px;"></div>
          </div>
        </div>
      `;
      container.insertAdjacentHTML('beforeend', html);
    });

    function toggleAccordion(eventName) {
      const acc = document.getElementById('accordion-' + eventName);
      const arrow = document.getElementById('arrow-' + eventName);
      if (acc.classList.contains('open')) {
        acc.classList.remove('open');
        arrow.classList.remove('open');
      } else {
        acc.classList.add('open');
        arrow.classList.add('open');
      }
    }
    function resetOfficialEventValue(eventName) {
      document.getElementById('officialEventValue_' + eventName).value = JSON.stringify(eventParams[eventName] || {}, null, 2);
    }
    function testOfficialEventEditable(eventName) {
      if (!checkBridgeEnv()) {
        showResult('result-officialEvent-' + eventName, 'eventTracker', {}, '[æœªæ£€æµ‹åˆ°æ¡¥æ¥ç¯å¢ƒ]');
        return;
      }
      let eventValueStr = document.getElementById('officialEventValue_' + eventName).value;
      let eventValue = safeParse(eventValueStr);
      if (eventValue === null) return;
      window.flutter_inappwebview.callHandler('eventTracker', { eventName, eventValue })
        .then(function (result) {
          showResult('result-officialEvent-' + eventName, 'eventTracker', { eventName, eventValue }, result);
        })
        .catch(function (err) {
          showResult('result-officialEvent-' + eventName, 'eventTracker', { eventName, eventValue }, '[å¼‚å¸¸] ' + err);
        });
    }

    // æ¸²æŸ“æ‰€æœ‰ä¸€çº§åŠŸèƒ½åŒºä¸ºæŠ˜å é¢æ¿
    document.addEventListener('DOMContentLoaded', function () {
      console.log('ğŸ”„ å¼€å§‹è½¬æ¢ä¸ºæŠ˜å é¢æ¿...');

      const sectionTitles = [
        '1. eventTracker æµ‹è¯•',
        '2. openWebView æµ‹è¯•',
        '3. openAndroid æµ‹è¯•',
        '4. closeWebView æµ‹è¯•',
        '5. getUseragent æµ‹è¯•',
        '6. googleLogin æµ‹è¯•',
        '7. facebookLogin æµ‹è¯•',
        '8. getFcmToken æµ‹è¯•',
        '9. alert æµ‹è¯•',
        '10. openWindow æµ‹è¯•',
        '11. handleHtmlLink æµ‹è¯•',
        '12. åŸç”ŸJSèƒ½åŠ›æ¡¥æ¥æµ‹è¯•'
      ];
      const allSections = Array.from(document.querySelectorAll('.section'));
      allSections.forEach((section, idx) => {
        const title = sectionTitles[idx] || `åŠŸèƒ½åŒº${idx + 1}`;
        const content = section.innerHTML;
        const html = `
          <div class="accordion-main" id="main-accordion-${idx}">
            <div class="accordion-main-header" onclick="toggleMainAccordion(${idx})">
              <span>${title}</span>
              <span class="accordion-main-arrow" id="main-arrow-${idx}">â–¶</span>
            </div>
            <div class="accordion-main-content">
              ${content}
            </div>
          </div>
        `;
        section.outerHTML = html;
      });

      console.log('âœ… æŠ˜å é¢æ¿è½¬æ¢å®Œæˆ');

      // å…³é”®ä¿®å¤ï¼šDOMé‡å»ºåé‡æ–°ç»‘å®š handleHtmlLink äº‹ä»¶
      console.log('ğŸ”§ DOMé‡å»ºåé‡æ–°ç»‘å®š handleHtmlLink äº‹ä»¶...');

      // å»¶è¿Ÿä¸€ä¸‹ç¡®ä¿DOMæ›´æ–°å®Œæˆ
      setTimeout(function () {
        initializeHandleHtmlLinkEvents();
        console.log('ğŸ”„ handleHtmlLink äº‹ä»¶é‡æ–°ç»‘å®šå®Œæˆ');
      }, 100);
    });
    function toggleMainAccordion(idx) {
      const acc = document.getElementById('main-accordion-' + idx);
      const arrow = document.getElementById('main-arrow-' + idx);
      if (acc.classList.contains('open')) {
        acc.classList.remove('open');
        arrow.classList.remove('open');
      } else {
        acc.classList.add('open');
        arrow.classList.add('open');
      }
    }
  </script>
</body>

</html>
